"use strict";(self.webpackChunktop_nutrition_app=self.webpackChunktop_nutrition_app||[]).push([[810],{810:(n,t,e)=>{e.r(t),e.d(t,{default:()=>O});var o=e(2791),l=e(3995),a=e(1694),i=e.n(a),s=e(1363),r=e(1335),c=e(9940),u=e(1429);const p=(n,t)=>{const{lat:e,lon:o}=n,{lat:l,lon:a}=t,i=.017453292519943295,s=Math.cos,r=.5-s((l-e)*i)/2+s(e*i)*s(l*i)*(1-s((a-o)*i))/2;return 12742*Math.asin(Math.sqrt(r))},d=async n=>{var t,e,o,l;const a=await n.text(),i=new r.XMLParser({ignoreAttributes:!1}).parse(a,!0);if(null===i||void 0===i||null===(t=i.gpx)||void 0===t||null===(e=t.trk)||void 0===e||null===(o=e.trkseg)||void 0===o||null===(l=o.trkpt)||void 0===l||!l.length)throw new Error("Invalid or empty GPX file");return{name:(s=i).gpx.trk.name,points:s.gpx.trk.trkseg.trkpt.map((n=>{var t;return{lat:parseFloat(n["@_lat"].toString()),lon:parseFloat(n["@_lon"].toString()),elevation:null!==(t=n.ele)&&void 0!==t?t:null}}))};var s},x={minElevation:null,maxElevation:null,lengthKm:0,elevationGain:0,elevationLoss:0},g=n=>{const t={...x};return n.points.forEach(((n,e,o)=>{const l=n.elevation,a=o[e+1];if(null!==l){(null===t.minElevation||l<t.minElevation)&&(t.minElevation=l),(null===t.maxElevation||l>t.maxElevation)&&(t.maxElevation=l);const n=null===a||void 0===a?void 0:a.elevation;if(!Number.isFinite(n))return;const e=n-l;e<0?t.elevationLoss-=e:t.elevationGain+=e}a&&(t.lengthKm+=p(n,a))})),t},m=n=>{const{points:t}=n;if(t.length<=1)throw new Error("Insufficient points for computing GPX Viewport");const e=t.map((n=>n.lat)),o=t.map((n=>n.lon)),l=c.Z.average(...e),a=c.Z.average(...o),i=c.Z.min(...e),s=c.Z.max(...e);return{center:[l,a],bounds:[[i,c.Z.min(...o)],[s,c.Z.max(...o)]]}},v=n=>{if(0===n.points.length)return[];const t=[0];let e=0;for(const o in n.points){const l=n.points[o],a=n.points[+o+1];if(!a)break;e+=p(l,a),t.push(e)}return t},h=n=>{if(n.points.length<=1)return"";const t={min:0,max:100},[e,o]=[c.Z.normalize(t,...n.points.map((n=>n.lat))),c.Z.normalize(t,...n.points.map((n=>n.lon)))],l=n=>Math.round(n),a=(n,t)=>" ".concat(n," ").concat(l(t[0])," ").concat(l(t[1]));let i=a("M",[e[0],o[0]]);return u.Z.zip(e,o).slice(1).forEach(((n,t)=>{i+=a("L",n)})),i};var f=e(801),y=e(9961),j=e(7626),b=e(5445),M=e(6293),k=e(5758);const w={min:{value:c.Z.degToRad(-70),color:[0,255,0]},max:{value:c.Z.degToRad(50),color:[255,0,0]}},I=(n,t)=>{const e=((n,t)=>{const e=Math.abs(p(n,t));if(null===t.elevation||null===n.elevation)return null;const o=(t.elevation-n.elevation)/1e3;return Math.atan(o/e)})(n,t);if(null===e)return[0,0,0];const o=c.Z.ratioIn(w.min.value,e,w.max.value),l=c.Z.clip(0,o,1);return c.Z.interpolateVector(w.min.color,w.max.color,l)},Z=n=>"rgb(".concat(n[0],",").concat(n[1],",").concat(n[2],")");var C=e(184);const P=function(n,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,o=1/0,l=-1;for(let a=0;a<t.length;a++){const e=t[a],i=n.distanceTo([e.lat,e.lon]);i<o&&(l=a,o=i)}return o>e?null:l};function N(n){let{gpx:t,onInspectPointIndex:e}=n;const l=(0,o.useMemo)((()=>t.points),[t]);return(0,M.$_)("click",(n=>{const t=n.latlng,o=P(t,l);null!==o&&e(o)})),(0,C.jsx)(C.Fragment,{children:l.map(((n,t)=>t===l.length-1?null:(0,C.jsx)(k.a,{color:Z(I(n,l[t+1])),positions:[[n.lat,n.lon],[l[t+1].lat,l[t+1].lon]]},"".concat(t,"-").concat(n.lat,"-").concat(n.lon,"-").concat(n.lat,"-").concat(n.lon))))})}var E=e(3402);const S=n=>{const{heading:t,latitude:e,longitude:o}=n.coords;if(null===t)return null;const l=c.Z.degToRad(c.Z.normalizeDegree(t-30)),a=c.Z.degToRad(c.Z.normalizeDegree(t+30));return[[[e,o],[e+10*Math.sin(l),o+10*Math.cos(l)]],[[e,o],[e+10*Math.sin(a),o+10*Math.cos(a)]]]};function D(){const[n,t]=(0,o.useState)(null);if((0,o.useEffect)((()=>{const n=window.navigator.geolocation.watchPosition(t,(()=>E.Am.error("Unable to get your location")));return()=>window.navigator.geolocation.clearWatch(n)}),[]),!n)return null;const e=(100-n.coords.accuracy)/100,[l]=c.Z.interpolateVector([40],[500],e),a=S(n);return(0,C.jsxs)(C.Fragment,{children:[a&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(k.a,{positions:a[0],color:"blue"}),(0,C.jsx)(k.a,{positions:a[1],color:"blue"})]}),(0,C.jsx)(b.C,{center:[n.coords.latitude,n.coords.longitude],radius:l})]})}function G(n){var t;let{className:e,gpx:o,inspectingPointIndex:l,onInspectPointIndex:a}=n;const i=m(o),s=null!==(t=o.points[null!==l&&void 0!==l?l:-1])&&void 0!==t?t:null;return(0,C.jsxs)(y.h,{zoomControl:!1,center:i.center,zoom:12,className:e,style:{height:"35vh"},children:[(0,C.jsx)(j.I,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,C.jsx)(N,{gpx:o,onInspectPointIndex:a}),(0,C.jsx)(D,{}),s&&(0,C.jsx)(b.C,{center:[s.lat,s.lon],pathOptions:{color:"orange",fillColor:"orange"},radius:60})]})}var F=e(9683),z=e(6845);const L={responsive:!0,animation:{duration:0},plugins:{tooltip:{enabled:!1},legend:{display:!1},annotation:{annotations:{}}}},R=n=>{let{yValues:t,index:e,color:o,yMax:l,yMin:a,name:i}=n;return{["".concat(i,"-line-horizontal")]:{type:"line",borderColor:o,borderWidth:2,xMax:t.length-1,xMin:0,xScaleID:"x",yMax:t[e],yMin:t[e],yScaleID:"y"},["".concat(i,"-line")]:{type:"line",borderColor:o,borderWidth:2,xMax:e,xMin:e,xScaleID:"x",yMax:l,yMin:a,yScaleID:"y"},["".concat(i,"-point")]:{type:"point",backgroundColor:o,radius:3,borderWidth:0,xValue:e,xScaleID:"x",yValue:t[e],yScaleID:"y"}}},A=100;function V(n){let{gpx:t,inspectPointAtIndex:e,onInspectPointAtIndex:l}=n;const a=(0,o.useRef)(null),i=(0,o.useMemo)((()=>t.points.map((n=>n.elevation))),[t]),s=(0,o.useMemo)((()=>v(t).map((n=>"".concat(n.toFixed(1)," km")))),[t]),r=function(n){let{elevations:t,inspectPointIndex:e}=n;const l=(0,o.useMemo)((()=>c.Z.max(...t)+A),[t]),a=(0,o.useMemo)((()=>c.Z.min(...t)-A),[t]),i={...L,scales:{y:{min:a,max:l}}};return e>=0&&(i.plugins.annotation.annotations={...i.plugins.annotation.annotations,...R({index:e,yValues:t,yMax:l,yMin:a,name:"inspect",color:"orange"})}),i}({elevations:i,inspectPointIndex:e});if(0===i.length)return null;const u={labels:s,datasets:[{label:"Elevation",data:i,pointRadius:1,lineTension:.8,borderColor:z.Al.fat}]};return(0,C.jsx)(F.kL,{ref:a,type:"line",onClick:n=>{var t;const e=a.current;if(!e)return;const o=(0,F.cX)(e,n);var i,s;void 0!==(null===(t=o[0])||void 0===t?void 0:t.index)&&l(null!==(i=null===(s=o[0])||void 0===s?void 0:s.index)&&void 0!==i?i:-1)},height:96,data:u,options:r})}var _=e(2759);function T(n){let{className:t,gpx:e}=n;const o=g(e);return(0,C.jsxs)("div",{className:i()("grid grid-cols-2 gap-2",t),children:[(0,C.jsx)(_.Z,{label:"Distance",value:o.lengthKm,unit:"km"}),(0,C.jsx)(_.Z,{label:"Highest point",value:o.maxElevation,unit:"hm"}),(0,C.jsx)(_.Z,{label:"Elevation Gain",value:o.elevationGain,unit:"hm",className:"col-start-1"}),(0,C.jsx)(_.Z,{label:"Elevation Loss",value:o.elevationLoss,unit:"hm"})]})}function X(n){let{opened:t,onClose:e,gpx:l}=n;const[a,i]=(0,o.useState)(-1);return(0,C.jsxs)(f.Z,{opened:t,onClose:e,label:"GPX Details",children:[(0,C.jsx)(G,{inspectingPointIndex:a,onInspectPointIndex:i,gpx:l,className:"rounded-lg w-full"}),(0,C.jsx)(V,{inspectPointAtIndex:a,onInspectPointAtIndex:i,gpx:l}),(0,C.jsx)(T,{gpx:l,className:"w-full"})]})}function W(n){let{gpx:t,className:e}=n;const[l,a]=(0,o.useState)(!1),i=(0,o.useMemo)((()=>h(t)),[t]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{onClick:n=>n.stopPropagation(),children:(0,C.jsx)(X,{gpx:t,opened:l,onClose:()=>a(!1)})}),(0,C.jsx)("div",{onClick:n=>{n.stopPropagation(),a(!l)},className:"relative",children:(0,C.jsx)("svg",{viewBox:"-10 -10 120 120",width:"100%",height:"100%",className:e,style:{transform:"rotate(-80deg)"},xmlns:"http://www.w3.org/2000/svg",children:(0,C.jsx)("path",{fill:"none",style:{strokeLinejoin:"round"},stroke:"black",strokeWidth:1,d:i})})})]})}var K=e(7759);function B(n){let{gpx:t,className:e,onSelectGpx:l}=n;const a=(0,o.useRef)(null);return(0,C.jsxs)("div",{onClick:()=>{var n;null===(n=a.current)||void 0===n||n.click()},className:i()("relative cursor-pointer rounded-lg p-2 flex items-center bg-gray-300 gap-2",e),children:[(0,C.jsx)("input",{className:"hidden",type:"file",ref:a,accept:".gpx",onInput:async n=>{var t;const e=null===(t=n.target.files)||void 0===t?void 0:t[0];e&&l(e)}}),(0,C.jsx)("div",{className:"rounded-lg w-16 h-16 flex items-center justify-center",children:t?(0,C.jsx)(W,{gpx:t}):(0,C.jsx)(s.G,{icon:"map",className:"child:fill-gray-100 w-4 h-4"})}),!!t&&(0,C.jsx)("div",{className:"absolute -right-2 -bottom-2",onClick:n=>n.stopPropagation(),children:(0,C.jsx)(K.C,{className:"w-4 h-4",icon:"trash",textClassName:"w-2 h-2",buttonStyle:K.Z.BlockDanger,onClick:()=>l(void 0)})})]})}const H=[l.g.Hiking,l.g.Running];function O(n){let{record:t,className:e,onChange:l}=n;const[a,i]=(0,o.useState)(null),s=H.includes(t.type);if((0,o.useEffect)((()=>{const n=t.gpx;n?d(n).then(i).catch((()=>{E.ZP.error("Failed to parse GPX File")})):i(null)}),[t]),!s)return null;return(0,C.jsx)(B,{gpx:null!==a&&void 0!==a?a:void 0,className:e,onSelectGpx:n=>{l({...t,gpx:n})}})}}}]);
//# sourceMappingURL=810.be01e105.chunk.js.map