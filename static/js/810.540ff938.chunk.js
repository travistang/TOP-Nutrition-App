"use strict";(self.webpackChunktop_nutrition_app=self.webpackChunktop_nutrition_app||[]).push([[810],{810:function(n,t,e){e.r(t),e.d(t,{default:function(){return Y}});var o=e(1413),a=e(9439),r=e(2791),i=e(3995),l=e(4165),u=e(5861),s=e(1694),c=e.n(s),p=e(1363),d=e(3433),v=e(1335),x=e(9940),f=e(1429),g=function(n,t){var e=n.lat,o=n.lon,a=t.lat,r=t.lon,i=.017453292519943295,l=Math.cos,u=.5-l((a-e)*i)/2+l(e*i)*l(a*i)*(1-l((r-o)*i))/2;return 12742*Math.asin(Math.sqrt(u))},m=function(){var n=(0,u.Z)((0,l.Z)().mark((function n(t){var e,o,a,r,i,u,s;return(0,l.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.text();case 2:if(i=n.sent,u=new v.XMLParser({ignoreAttributes:!1}),null!==(s=u.parse(i,!0))&&void 0!==s&&null!==(e=s.gpx)&&void 0!==e&&null!==(o=e.trk)&&void 0!==o&&null!==(a=o.trkseg)&&void 0!==a&&null!==(r=a.trkpt)&&void 0!==r&&r.length){n.next=7;break}throw new Error("Invalid or empty GPX file");case 7:return n.abrupt("return",{name:(l=s).gpx.trk.name,points:l.gpx.trk.trkseg.trkpt.map((function(n){var t;return{lat:parseFloat(n["@_lat"].toString()),lon:parseFloat(n["@_lon"].toString()),elevation:null!==(t=n.ele)&&void 0!==t?t:null}}))});case 8:case"end":return n.stop()}var l}),n)})));return function(t){return n.apply(this,arguments)}}(),h={minElevation:null,maxElevation:null,lengthKm:0,elevationGain:0,elevationLoss:0},Z=function(n){var t=(0,o.Z)({},h);return n.points.forEach((function(n,e,o){var a=n.elevation,r=o[e+1];if(null!==a){(null===t.minElevation||a<t.minElevation)&&(t.minElevation=a),(null===t.maxElevation||a>t.maxElevation)&&(t.maxElevation=a);var i=null===r||void 0===r?void 0:r.elevation;if(!Number.isFinite(i))return;var l=i-a;l<0?t.elevationLoss-=l:t.elevationGain+=l}r&&(t.lengthKm+=g(n,r))})),t},y=function(n){var t=n.points;if(t.length<=1)throw new Error("Insufficient points for computing GPX Viewport");var e=t.map((function(n){return n.lat})),o=t.map((function(n){return n.lon})),a=x.Z.average.apply(x.Z,(0,d.Z)(e)),r=x.Z.average.apply(x.Z,(0,d.Z)(o)),i=x.Z.min.apply(x.Z,(0,d.Z)(e)),l=x.Z.max.apply(x.Z,(0,d.Z)(e));return{center:[a,r],bounds:[[i,x.Z.min.apply(x.Z,(0,d.Z)(o))],[l,x.Z.max.apply(x.Z,(0,d.Z)(o))]]}},j=function(n){if(0===n.points.length)return[];var t=[0],e=0;for(var o in n.points){var a=n.points[o],r=n.points[+o+1];if(!r)break;e+=g(a,r),t.push(e)}return t},b=function(n){if(n.points.length<=1)return"";var t={min:0,max:100},e=[x.Z.normalize.apply(x.Z,[t].concat((0,d.Z)(n.points.map((function(n){return n.lat}))))),x.Z.normalize.apply(x.Z,[t].concat((0,d.Z)(n.points.map((function(n){return n.lon})))))],o=e[0],a=e[1],r=function(n){return Math.round(n)},i=function(n,t){return" ".concat(n," ").concat(r(t[0])," ").concat(r(t[1]))},l=i("M",[o[0],a[0]]);return f.Z.zip(o,a).slice(1).forEach((function(n,t){l+=i("L",n)})),l},k=e(801),w=e(9961),M=e(7626),I=e(5445),C=e(6293),P=e(5758),N={min:{value:x.Z.degToRad(-70),color:[0,255,0]},max:{value:x.Z.degToRad(50),color:[255,0,0]}},E=function(n,t){var e=function(n,t){var e=Math.abs(g(n,t));if(null===t.elevation||null===n.elevation)return null;var o=(t.elevation-n.elevation)/1e3;return Math.atan(o/e)}(n,t);if(null===e)return[0,0,0];var o=x.Z.ratioIn(N.min.value,e,N.max.value),a=x.Z.clip(0,o,1);return x.Z.interpolateVector(N.min.color,N.max.color,a)},S=function(n){return"rgb(".concat(n[0],",").concat(n[1],",").concat(n[2],")")},D=e(184),G=function(n,t){for(var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,o=1/0,a=-1,r=0;r<t.length;r++){var i=t[r],l=n.distanceTo([i.lat,i.lon]);l<o&&(a=r,o=l)}return o>e?null:a};function F(n){var t=n.gpx,e=n.onInspectPointIndex,o=(0,r.useMemo)((function(){return t.points}),[t]);return(0,C.$_)("click",(function(n){var t=n.latlng,a=G(t,o);null!==a&&e(a)})),(0,D.jsx)(D.Fragment,{children:o.map((function(n,t){return t===o.length-1?null:(0,D.jsx)(P.a,{color:S(E(n,o[t+1])),positions:[[n.lat,n.lon],[o[t+1].lat,o[t+1].lon]]},"".concat(t,"-").concat(n.lat,"-").concat(n.lon,"-").concat(n.lat,"-").concat(n.lon))}))})}var z=e(3402),L=function(n){var t=n.coords,e=t.heading,o=t.latitude,a=t.longitude;if(null===e)return null;var r=x.Z.degToRad(x.Z.normalizeDegree(e-30)),i=x.Z.degToRad(x.Z.normalizeDegree(e+30));return[[[o,a],[o+10*Math.sin(r),a+10*Math.cos(r)]],[[o,a],[o+10*Math.sin(i),a+10*Math.cos(i)]]]};function R(){var n=(0,r.useState)(null),t=(0,a.Z)(n,2),e=t[0],o=t[1];if((0,r.useEffect)((function(){var n=window.navigator.geolocation.watchPosition(o,(function(){return z.Am.error("Unable to get your location")}));return function(){return window.navigator.geolocation.clearWatch(n)}}),[]),!e)return null;var i=(100-e.coords.accuracy)/100,l=x.Z.interpolateVector([40],[500],i),u=(0,a.Z)(l,1)[0],s=L(e);return(0,D.jsxs)(D.Fragment,{children:[s&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(P.a,{positions:s[0],color:"blue"}),(0,D.jsx)(P.a,{positions:s[1],color:"blue"})]}),(0,D.jsx)(I.C,{center:[e.coords.latitude,e.coords.longitude],radius:u})]})}function A(n){var t,e=n.className,o=n.gpx,a=n.inspectingPointIndex,r=n.onInspectPointIndex,i=y(o),l=null!==(t=o.points[null!==a&&void 0!==a?a:-1])&&void 0!==t?t:null;return(0,D.jsxs)(w.h,{zoomControl:!1,center:i.center,zoom:12,className:e,style:{height:"35vh"},children:[(0,D.jsx)(M.I,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,D.jsx)(F,{gpx:o,onInspectPointIndex:r}),(0,D.jsx)(R,{}),l&&(0,D.jsx)(I.C,{center:[l.lat,l.lon],pathOptions:{color:"orange",fillColor:"orange"},radius:60})]})}var V=e(9683),_=e(6845),T=e(4942),X={responsive:!0,animation:{duration:0},plugins:{tooltip:{enabled:!1},legend:{display:!1},annotation:{annotations:{}}}},W=function(n){var t,e=n.yValues,o=n.index,a=n.color,r=n.yMax,i=n.yMin,l=n.name;return t={},(0,T.Z)(t,"".concat(l,"-line-horizontal"),{type:"line",borderColor:a,borderWidth:2,xMax:e.length-1,xMin:0,xScaleID:"x",yMax:e[o],yMin:e[o],yScaleID:"y"}),(0,T.Z)(t,"".concat(l,"-line"),{type:"line",borderColor:a,borderWidth:2,xMax:o,xMin:o,xScaleID:"x",yMax:r,yMin:i,yScaleID:"y"}),(0,T.Z)(t,"".concat(l,"-point"),{type:"point",backgroundColor:a,radius:3,borderWidth:0,xValue:o,xScaleID:"x",yValue:e[o],yScaleID:"y"}),t},K=100;function B(n){var t=n.gpx,e=n.inspectPointAtIndex,a=n.onInspectPointAtIndex,i=(0,r.useRef)(null),l=(0,r.useMemo)((function(){return t.points.map((function(n){return n.elevation}))}),[t]),u=(0,r.useMemo)((function(){return j(t).map((function(n){return"".concat(n.toFixed(1)," km")}))}),[t]),s=function(n){var t=n.elevations,e=n.inspectPointIndex,a=(0,r.useMemo)((function(){return x.Z.max.apply(x.Z,(0,d.Z)(t))+K}),[t]),i=(0,r.useMemo)((function(){return x.Z.min.apply(x.Z,(0,d.Z)(t))-K}),[t]),l=(0,o.Z)((0,o.Z)({},X),{},{scales:{y:{min:i,max:a}}});return e>=0&&(l.plugins.annotation.annotations=(0,o.Z)((0,o.Z)({},l.plugins.annotation.annotations),W({index:e,yValues:t,yMax:a,yMin:i,name:"inspect",color:"orange"}))),l}({elevations:l,inspectPointIndex:e});if(0===l.length)return null;var c={labels:u,datasets:[{label:"Elevation",data:l,pointRadius:1,lineTension:.8,borderColor:_.Al.fat}]};return(0,D.jsx)(V.kL,{ref:i,type:"line",onClick:function(n){var t,e=i.current;if(e){var o,r,l=(0,V.cX)(e,n);if(void 0!==(null===(t=l[0])||void 0===t?void 0:t.index))a(null!==(o=null===(r=l[0])||void 0===r?void 0:r.index)&&void 0!==o?o:-1)}},height:96,data:c,options:s})}var H=e(2759);function O(n){var t=n.className,e=n.gpx,o=Z(e);return(0,D.jsxs)("div",{className:c()("grid grid-cols-2 gap-2",t),children:[(0,D.jsx)(H.Z,{label:"Distance",value:o.lengthKm,unit:"km"}),(0,D.jsx)(H.Z,{label:"Highest point",value:o.maxElevation,unit:"hm"}),(0,D.jsx)(H.Z,{label:"Elevation Gain",value:o.elevationGain,unit:"hm",className:"col-start-1"}),(0,D.jsx)(H.Z,{label:"Elevation Loss",value:o.elevationLoss,unit:"hm"})]})}function q(n){var t=n.opened,e=n.onClose,o=n.gpx,i=(0,r.useState)(-1),l=(0,a.Z)(i,2),u=l[0],s=l[1];return(0,D.jsxs)(k.Z,{opened:t,onClose:e,label:"GPX Details",children:[(0,D.jsx)(A,{inspectingPointIndex:u,onInspectPointIndex:s,gpx:o,className:"rounded-lg w-full"}),(0,D.jsx)(B,{inspectPointAtIndex:u,onInspectPointAtIndex:s,gpx:o}),(0,D.jsx)(O,{gpx:o,className:"w-full"})]})}function U(n){var t=n.gpx,e=n.className,o=(0,r.useState)(!1),i=(0,a.Z)(o,2),l=i[0],u=i[1],s=(0,r.useMemo)((function(){return b(t)}),[t]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{onClick:function(n){return n.stopPropagation()},children:(0,D.jsx)(q,{gpx:t,opened:l,onClose:function(){return u(!1)}})}),(0,D.jsx)("div",{onClick:function(n){n.stopPropagation(),u(!l)},className:"relative",children:(0,D.jsx)("svg",{viewBox:"-10 -10 120 120",width:"100%",height:"100%",className:e,style:{transform:"rotate(-80deg)"},xmlns:"http://www.w3.org/2000/svg",children:(0,D.jsx)("path",{fill:"none",style:{strokeLinejoin:"round"},stroke:"black",strokeWidth:1,d:s})})})]})}var $=e(7759);function J(n){var t=n.gpx,e=n.className,o=n.onSelectGpx,a=(0,r.useRef)(null),i=function(){var n=(0,u.Z)((0,l.Z)().mark((function n(t){var e,a;return(0,l.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=null===(e=t.target.files)||void 0===e?void 0:e[0]){n.next=3;break}return n.abrupt("return");case 3:o(a);case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();return(0,D.jsxs)("div",{onClick:function(){var n;null===(n=a.current)||void 0===n||n.click()},className:c()("relative cursor-pointer rounded-lg p-2 flex items-center bg-gray-300 gap-2",e),children:[(0,D.jsx)("input",{className:"hidden",type:"file",ref:a,accept:".gpx",onInput:i}),(0,D.jsx)("div",{className:"rounded-lg w-16 h-16 flex items-center justify-center",children:t?(0,D.jsx)(U,{gpx:t}):(0,D.jsx)(p.G,{icon:"map",className:"child:fill-gray-100 w-4 h-4"})}),!!t&&(0,D.jsx)("div",{className:"absolute -right-2 -bottom-2",onClick:function(n){return n.stopPropagation()},children:(0,D.jsx)($.C,{className:"w-4 h-4",icon:"trash",textClassName:"w-2 h-2",buttonStyle:$.Z.BlockDanger,onClick:function(){return o(void 0)}})})]})}var Q=[i.g.Hiking,i.g.Running];function Y(n){var t=n.record,e=n.className,i=n.onChange,l=(0,r.useState)(null),u=(0,a.Z)(l,2),s=u[0],c=u[1],p=Q.includes(t.type);if((0,r.useEffect)((function(){var n=t.gpx;n?m(n).then(c).catch((function(){z.ZP.error("Failed to parse GPX File")})):c(null)}),[t]),!p)return null;return(0,D.jsx)(J,{gpx:null!==s&&void 0!==s?s:void 0,className:e,onSelectGpx:function(n){i((0,o.Z)((0,o.Z)({},t),{},{gpx:n}))}})}}}]);
//# sourceMappingURL=810.540ff938.chunk.js.map