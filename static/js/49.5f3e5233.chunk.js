"use strict";(self.webpackChunktop_nutrition_app=self.webpackChunktop_nutrition_app||[]).push([[49],{9049:(n,e,t)=>{t.r(e),t.d(e,{default:()=>O});var o=t(2483),l=t(7882),i=t(1097),a=t.n(i),s=t(7859),r=t(4977),c=t(6587),u=t(9721);const p=(n,e)=>{const{lat:t,lon:o}=n,{lat:l,lon:i}=e,a=.017453292519943295,s=Math.cos,r=.5-s((l-t)*a)/2+s(t*a)*s(l*a)*(1-s((i-o)*a))/2;return 12742*Math.asin(Math.sqrt(r))},d=async n=>{var e,t,o,l;const i=await n.text(),a=new r.XMLParser({ignoreAttributes:!1}).parse(i,!0);if(null===a||void 0===a||null===(e=a.gpx)||void 0===e||null===(t=e.trk)||void 0===t||null===(o=t.trkseg)||void 0===o||null===(l=o.trkpt)||void 0===l||!l.length)throw new Error("Invalid or empty GPX file");return{name:(s=a).gpx.trk.name,points:s.gpx.trk.trkseg.trkpt.map((n=>{var e;return{lat:parseFloat(n["@_lat"].toString()),lon:parseFloat(n["@_lon"].toString()),elevation:null!==(e=n.ele)&&void 0!==e?e:null}}))};var s},x={minElevation:null,maxElevation:null,lengthKm:0,elevationGain:0,elevationLoss:0},g=n=>{const e={...x};return n.points.forEach(((n,t,o)=>{const l=n.elevation,i=o[t+1];if(null!==l){(null===e.minElevation||l<e.minElevation)&&(e.minElevation=l),(null===e.maxElevation||l>e.maxElevation)&&(e.maxElevation=l);const n=null===i||void 0===i?void 0:i.elevation;if(!Number.isFinite(n))return;const t=n-l;t<0?e.elevationLoss-=t:e.elevationGain+=t}i&&(e.lengthKm+=p(n,i))})),e},v=n=>{const{points:e}=n;if(e.length<=1)throw new Error("Insufficient points for computing GPX Viewport");const t=e.map((n=>n.lat)),o=e.map((n=>n.lon)),l=c.A.average(...t),i=c.A.average(...o),a=c.A.min(...t),s=c.A.max(...t);return{center:[l,i],bounds:[[a,c.A.min(...o)],[s,c.A.max(...o)]]}},m=n=>{if(0===n.points.length)return[];const e=[0];let t=0;for(const o in n.points){const l=n.points[o],i=n.points[+o+1];if(!i)break;t+=p(l,i),e.push(t)}return e},h=n=>{if(n.points.length<=1)return"";const e={min:0,max:100},[t,o]=[c.A.normalize(e,...n.points.map((n=>n.lat))),c.A.normalize(e,...n.points.map((n=>n.lon)))],l=n=>Math.round(n),i=(n,e)=>` ${n} ${l(e[0])} ${l(e[1])}`;let a=i("M",[t[0],o[0]]);return u.A.zip(t,o).slice(1).forEach(((n,e)=>{a+=i("L",n)})),a};var f=t(1171),j=t(3897),y=t(852),b=t(1693),A=t(9174),M=t(6528);const k={min:{value:c.A.degToRad(-70),color:[0,255,0]},max:{value:c.A.degToRad(50),color:[255,0,0]}},w=(n,e)=>{const t=((n,e)=>{const t=Math.abs(p(n,e));if(null===e.elevation||null===n.elevation)return null;const o=(e.elevation-n.elevation)/1e3;return Math.atan(o/t)})(n,e);if(null===t)return[0,0,0];const o=c.A.ratioIn(k.min.value,t,k.max.value),l=c.A.clip(0,o,1);return c.A.interpolateVector(k.min.color,k.max.color,l)},I=n=>`rgb(${n[0]},${n[1]},${n[2]})`;var N=t(6723);const P=function(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,o=1/0,l=-1;for(let i=0;i<e.length;i++){const t=e[i],a=n.distanceTo([t.lat,t.lon]);a<o&&(l=i,o=a)}return o>t?null:l};function C(n){let{gpx:e,onInspectPointIndex:t}=n;const l=(0,o.useMemo)((()=>e.points),[e]);return(0,A.gY)("click",(n=>{const e=n.latlng,o=P(e,l);null!==o&&t(o)})),(0,N.jsx)(N.Fragment,{children:l.map(((n,e)=>e===l.length-1?null:(0,N.jsx)(M.R,{color:I(w(n,l[e+1])),positions:[[n.lat,n.lon],[l[e+1].lat,l[e+1].lon]]},`${e}-${n.lat}-${n.lon}-${n.lat}-${n.lon}`)))})}var E=t(9196);const S=n=>{const{heading:e,latitude:t,longitude:o}=n.coords;if(null===e)return null;const l=c.A.degToRad(c.A.normalizeDegree(e-30)),i=c.A.degToRad(c.A.normalizeDegree(e+30));return[[[t,o],[t+10*Math.sin(l),o+10*Math.cos(l)]],[[t,o],[t+10*Math.sin(i),o+10*Math.cos(i)]]]};function $(){const[n,e]=(0,o.useState)(null);if((0,o.useEffect)((()=>{const n=window.navigator.geolocation.watchPosition(e,(()=>E.oR.error("Unable to get your location")));return()=>window.navigator.geolocation.clearWatch(n)}),[]),!n)return null;const t=(100-n.coords.accuracy)/100,[l]=c.A.interpolateVector([40],[500],t),i=S(n);return(0,N.jsxs)(N.Fragment,{children:[i&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(M.R,{positions:i[0],color:"blue"}),(0,N.jsx)(M.R,{positions:i[1],color:"blue"})]}),(0,N.jsx)(b.j,{center:[n.coords.latitude,n.coords.longitude],radius:l})]})}function R(n){var e;let{className:t,gpx:o,inspectingPointIndex:l,onInspectPointIndex:i}=n;const a=v(o),s=null!==(e=o.points[null!==l&&void 0!==l?l:-1])&&void 0!==e?e:null;return(0,N.jsxs)(j.W,{zoomControl:!1,center:a.center,zoom:12,className:t,style:{height:"35vh"},children:[(0,N.jsx)(y.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,N.jsx)(C,{gpx:o,onInspectPointIndex:i}),(0,N.jsx)($,{}),s&&(0,N.jsx)(b.j,{center:[s.lat,s.lon],pathOptions:{color:"orange",fillColor:"orange"},radius:60})]})}var D=t(4987),F=t(2076);const G={responsive:!0,animation:{duration:0},plugins:{tooltip:{enabled:!1},legend:{display:!1},annotation:{annotations:{}}}},z=n=>{let{yValues:e,index:t,color:o,yMax:l,yMin:i,name:a}=n;return{[`${a}-line-horizontal`]:{type:"line",borderColor:o,borderWidth:2,xMax:e.length-1,xMin:0,xScaleID:"x",yMax:e[t],yMin:e[t],yScaleID:"y"},[`${a}-line`]:{type:"line",borderColor:o,borderWidth:2,xMax:t,xMin:t,xScaleID:"x",yMax:l,yMin:i,yScaleID:"y"},[`${a}-point`]:{type:"point",backgroundColor:o,radius:3,borderWidth:0,xValue:t,xScaleID:"x",yValue:e[t],yScaleID:"y"}}},L=100;function V(n){let{gpx:e,inspectPointAtIndex:t,onInspectPointAtIndex:l}=n;const i=(0,o.useRef)(null),a=(0,o.useMemo)((()=>e.points.map((n=>n.elevation))),[e]),s=(0,o.useMemo)((()=>m(e).map((n=>`${n.toFixed(1)} km`))),[e]),r=function(n){let{elevations:e,inspectPointIndex:t}=n;const l=(0,o.useMemo)((()=>c.A.max(...e)+L),[e]),i=(0,o.useMemo)((()=>c.A.min(...e)-L),[e]),a={...G,scales:{y:{min:i,max:l}}};return t>=0&&(a.plugins.annotation.annotations={...a.plugins.annotation.annotations,...z({index:t,yValues:e,yMax:l,yMin:i,name:"inspect",color:"orange"})}),a}({elevations:a,inspectPointIndex:t});if(0===a.length)return null;const u={labels:s,datasets:[{label:"Elevation",data:a,pointRadius:1,lineTension:.8,borderColor:F.EU.fat}]};return(0,N.jsx)(D.t1,{ref:i,type:"line",onClick:n=>{var e;const t=i.current;if(!t)return;const o=(0,D.CK)(t,n);var a,s;void 0!==(null===(e=o[0])||void 0===e?void 0:e.index)&&l(null!==(a=null===(s=o[0])||void 0===s?void 0:s.index)&&void 0!==a?a:-1)},height:96,data:u,options:r})}var T=t(9235);function W(n){let{className:e,gpx:t}=n;const o=g(t);return(0,N.jsxs)("div",{className:a()("grid grid-cols-2 gap-2",e),children:[(0,N.jsx)(T.A,{label:"Distance",value:o.lengthKm,unit:"km"}),(0,N.jsx)(T.A,{label:"Highest point",value:o.maxElevation,unit:"hm"}),(0,N.jsx)(T.A,{label:"Elevation Gain",value:o.elevationGain,unit:"hm",className:"col-start-1"}),(0,N.jsx)(T.A,{label:"Elevation Loss",value:o.elevationLoss,unit:"hm"})]})}function _(n){let{opened:e,onClose:t,gpx:l}=n;const[i,a]=(0,o.useState)(-1);return(0,N.jsxs)(f.A,{opened:e,onClose:t,label:"GPX Details",children:[(0,N.jsx)(R,{inspectingPointIndex:i,onInspectPointIndex:a,gpx:l,className:"rounded-lg w-full"}),(0,N.jsx)(V,{inspectPointAtIndex:i,onInspectPointAtIndex:a,gpx:l}),(0,N.jsx)(W,{gpx:l,className:"w-full"})]})}function X(n){let{gpx:e,className:t}=n;const[l,i]=(0,o.useState)(!1),a=(0,o.useMemo)((()=>h(e)),[e]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{onClick:n=>n.stopPropagation(),children:(0,N.jsx)(_,{gpx:e,opened:l,onClose:()=>i(!1)})}),(0,N.jsx)("div",{onClick:n=>{n.stopPropagation(),i(!l)},className:"relative",children:(0,N.jsx)("svg",{viewBox:"-10 -10 120 120",width:"100%",height:"100%",className:t,style:{transform:"rotate(-80deg)"},xmlns:"http://www.w3.org/2000/svg",children:(0,N.jsx)("path",{fill:"none",style:{strokeLinejoin:"round"},stroke:"black",strokeWidth:1,d:a})})})]})}var K=t(8358);function B(n){let{gpx:e,className:t,onSelectGpx:l}=n;const i=(0,o.useRef)(null);return(0,N.jsxs)("div",{onClick:()=>{var n;null===(n=i.current)||void 0===n||n.click()},className:a()("relative cursor-pointer rounded-lg p-2 flex items-center bg-gray-300 gap-2",t),children:[(0,N.jsx)("input",{className:"hidden",type:"file",ref:i,accept:".gpx",onInput:async n=>{var e;const t=null===(e=n.target.files)||void 0===e?void 0:e[0];t&&l(t)}}),(0,N.jsx)("div",{className:"rounded-lg w-16 h-16 flex items-center justify-center",children:e?(0,N.jsx)(X,{gpx:e}):(0,N.jsx)(s.g,{icon:"map",className:"child:fill-gray-100 w-4 h-4"})}),!!e&&(0,N.jsx)("div",{className:"absolute -right-2 -bottom-2",onClick:n=>n.stopPropagation(),children:(0,N.jsx)(K.A,{className:"w-4 h-4",icon:"trash",textClassName:"w-2 h-2",buttonStyle:K.i.BlockDanger,onClick:()=>l(void 0)})})]})}const H=[l.v.Hiking,l.v.Running];function O(n){let{record:e,className:t,onChange:l}=n;const[i,a]=(0,o.useState)(null),s=H.includes(e.type);if((0,o.useEffect)((()=>{const n=e.gpx;n?d(n).then(a).catch((()=>{E.Ay.error("Failed to parse GPX File")})):a(null)}),[e]),!s)return null;return(0,N.jsx)(B,{gpx:null!==i&&void 0!==i?i:void 0,className:t,onSelectGpx:n=>{l({...e,gpx:n})}})}}}]);
//# sourceMappingURL=49.5f3e5233.chunk.js.map